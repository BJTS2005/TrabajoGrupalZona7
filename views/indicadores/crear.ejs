<%- include ../layout/cabecera.ejs %>

    <h1>Crear Indicador</h1>

    <form method="post" action="/indicadores/guardar">

        <div class="form-group">
            <label for="nombreIndicador">Nombre del Indicador:</label>
            <input id="nombreIndicador" class="form-control" type="text" name="nombre" required>
        </div>

        <div class="form-group">
            <label for="descripcionIndicador">Descripción:</label>
            <input id="descripcionIndicador" class="form-control" type="text" name="descripcion">
        </div>

        <div class="form-group">
            <label for="unidadIndicador">Magnitud:</label>
            <input id="unidadIndicador" class="form-control" type="text" name="unidadIndicador">
        </div>

        <br>
        <div id='container-opc'>
            <h3>Opciones</h3>
            <div id="opciones-container">

            </div>

            <button type="button" id="agregarOpcion" class="btn btn-secondary">Agregar Opción</button>
        </div>

        <br>
        <br>
        <div id='container-sub'>
            <h3>Subcomponentes</h3>
            <div id="subcomponentes-container">

            </div>

            <button type="button" id="agregarSubcomponente" class="btn btn-secondary">Agregar Subcomponente</button>
        </div>

        <br><br><br>
        <button type="submit" class="btn btn-primary">Crear Indicador</button>

    </form>

    <%- include ../layout/pie.ejs %>

        <script>
            let contadorOpciones = 0;
            let contadorSubcomponentes = 0;
            const opcionBtn = document.getElementById('agregarOpcion');
            const subBtn = document.getElementById('agregarSubcomponente');
            const opcionCont = document.getElementById('opciones-container');
            const subCont = document.getElementById('subcomponentes-container');
            const contSub = document.getElementById('container-sub');
            const contOpc = document.getElementById('container-opc');

            // Manejar la adición de opciones (categorías)
            opcionBtn.addEventListener('click', () => {
                if (contadorSubcomponentes > 0) {
                    alert('No puede agregar dos elementos diferentes en el mismo indicador.');
                } else {
                    const divOpc = document.createElement('div');
                    divOpc.classList.add('form-group');
                    divOpc.innerHTML = `
                    <label for="categoria${contadorOpciones}">Categoría:</label>
                    <input class="form-control" type="text" name="opciones[]" placeholder="Descripción de la opción" required>
                    <button type="button" class="btn btn-danger eliminar" onclick="eliminarElemento(this)">Eliminar</button><br><br><br>
                `;
                    opcionCont.appendChild(divOpc);

                    contadorOpciones++;
                    contOpc.style.display = 'block';
                    contSub.style.display = 'none';
                }
            });

            // Manejar la adición de subcomponentes
            subBtn.addEventListener('click', () => {
                if (contadorOpciones > 0) {
                    alert('No puede agregar dos elementos diferentes en el mismo indicador.');
                } else {
                    const divSub = document.createElement('div');
                    divSub.classList.add('form-group');
                    divSub.innerHTML = `
                    <label for="subcomponente${contadorSubcomponentes}">Subcomponente:</label>
                    <input class="form-control" type="text" name="subcomponentes[]" placeholder="Nombre del subcomponente" required>
                    <label for="valor${contadorSubcomponentes}">Valor:</label>
                    <input class="form-control" type="number" name="valores[]" placeholder="Valor del subcomponente" required>
                    
                    <!-- Campo adicional para seleccionar la unidad del subcomponente -->
                    <label for="unidad${contadorSubcomponentes}">Unidad:</label>
                    <select class="form-control" name="sub_unidades[]" required>
                        <!-- Opciones de unidades: estas deben ser dinámicas según tus unidades en la base de datos -->
                        <option value="unidad1">Unidad 1</option>
                        <option value="unidad2">Unidad 2</option>
                        <option value="unidad3">Unidad 3</option>
                        <!-- Añadir más unidades según tu base de datos -->
                    </select>
    
                    <button type="button" class="btn btn-danger eliminar" onclick="eliminarElemento(this)">Eliminar</button><br><br><br>
                `;
                    subCont.appendChild(divSub);

                    contadorSubcomponentes++;
                    contSub.style.display = 'block';
                    contOpc.style.display = 'none';
                }
            });

            // Función para eliminar un elemento (categoría o subcomponente)
            function eliminarElemento(button) {
                button.parentElement.remove();

                if (button.closest('#opciones-container')) {
                    contadorOpciones--;
                } else if (button.closest('#subcomponentes-container')) {
                    contadorSubcomponentes--;
                }

                // Ajustamos la visibilidad de los contenedores
                if (contadorOpciones === 0 && contadorSubcomponentes === 0) {
                    contOpc.style.display = 'none';
                    contSub.style.display = 'none';
                } else {
                    contOpc.style.display = (contadorOpciones > 0) ? 'block' : 'none';
                    contSub.style.display = (contadorSubcomponentes > 0) ? 'block' : 'none';
                }
            }
        </script>